/*! jquery-seethru 1.1.3 15-06-2014 see https://github.com/m90/jquery-seeThru for details */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports?require("jquery"):a.jQuery)}(this,function(a){function b(b,c){var d=a("<canvas>").attr({width:b.width,height:b.height}).get(0).getContext("2d");d.drawImage(c,0,0,b.width,b.height);for(var e=d.getImageData(0,0,b.width,b.height),f=3,g=e.data.length;g>f;f+=4)e.data[f-1]=e.data[f-2]=e.data[f-3]=e.data[f],e.data[f]=255;return e}function c(a,b){for(var c=3,d=a.data.length;d>c;c+=4)a.data[c]=b[c-1],a.data[c-3]=a.data[c-3]/(b[c-1]?b[c-1]/255:1),a.data[c-2]=a.data[c-2]/(b[c-1]?b[c-1]/255:1),a.data[c-1]=a.data[c-1]/(b[c-1]?b[c-1]/255:1)}var d={init:function(d){var e=a.extend({start:"autoplay",end:"loop",mask:!1,alphaMask:!1,width:"",height:"",poster:!1,unmult:!1,shimRAF:!0},d||{});return e.shimRAF&&!window.requestAnimationFrame&&!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),this.each(function(){if(a(this).data("seeThru"))throw new Error("seeThru already initialized on selected element");var d,f=!1,g=e.alphaMask===!0;if(e.mask&&a(e.mask).length){if(d=a(e.mask)[0],"IMG"!==d.tagName)throw new Error("Mask element must be <img>");a(d).hide(),f=!0}if("VIDEO"!==this.tagName)throw new Error("Selected element must be <video> element");a(this).on("loadedmetadata.seeThru",function(){function h(a){q.drawImage(j,0,0,l.width,l.height*k);var b=q.getImageData(0,0,l.width,l.height),d=q.getImageData(0,l.height,l.width,l.height).data;e.unmult&&c(b,d);for(var f=3,g=b.data.length;g>f;f+=4)b.data[f]=e.alphaMask?d[f-1]:Math.max(d[f-1],d[f-2],d[f-3]);p.putImageData(b,0,0,0,0,l.width,l.height),a&&(m=requestAnimationFrame(function(){h(!0)}),i.data("seeThru")&&(i.data("seeThru").interval=m))}var i=a(this),j=this,k=f?1:2,l={width:parseInt(e.width,10),height:parseInt(e.height,10)};l.height&&l.width||(i.attr("width")||i.attr("height")?i.attr("height")?i.attr("width")?(l.width=l.width||parseInt(j.width,10),l.height=l.height||parseInt(j.height,10)/k):(l.width=l.width||parseInt(j.height,10)*(j.videoWidth/Math.floor(j.videoHeight/k)),l.height=l.height||parseInt(j.height,10)):(l.width=l.width||parseInt(j.width,10),l.height=l.height||parseInt(j.width,10)/(j.videoWidth/Math.floor(j.videoHeight/k))):(l.width=l.width||j.videoWidth,l.height=l.height||j.videoHeight/k));var m,n=a("<canvas>",{"class":"seeThru-buffer"}).attr({width:l.width,height:2*l.height}).hide(),o=a("<canvas>",{"class":"seeThru-display"}).attr({width:l.width,height:l.height}),p=o[0].getContext("2d"),q=n[0].getContext("2d");f&&(d.width=l.width,d.height=l.height,g?q.putImageData(b(l,d),0,l.height):q.drawImage(d,0,l.height,l.width,l.height)),"stop"===e.end&&j.loop&&(j.loop=!1),e.poster&&i.wrap(a("<div>").css({position:"relative",width:l.width+"px",height:l.height+"px"}).addClass("seeThru-container")),i.hide().data("seeThru",{staticMask:f,alphaMask:g,interval:m}).after(n,o);var r=a({});e.poster&&i.attr("poster")&&(r=a("<div>").addClass("seeThru-poster").css({width:l.width+"px",height:l.height+"px",position:"absolute",top:0,left:0,"background-size":"cover","background-position":"center","background-image":'url("'+j.poster+'")'}),i.after(r));var s=["mouseenter","mouseleave","click","mousedown","mouseup","mousemove","mouseover","hover","dblclick","contextmenu","focus","blur"];o.add(r).on(s.join(" "),function(a){i.trigger(a)}),i.on("play.seeThru",function(){r.hide(),cancelAnimationFrame(m),m=requestAnimationFrame(function(){h(!0)}),i.data("seeThru").interval=m}).on("pause.seeThru",function(){cancelAnimationFrame(m),r.show()}),"autoplay"===e.start?i.trigger("play.seeThru"):"clicktoplay"===e.start?(j.play(),j.pause(),h(),o.one("click.seeThru",function(){j.play()})):"external"===e.start?(j.play(),j.pause(),h()):j.play(),"loop"===e.end?i.on("ended.seeThru",function(){i.one("pause",function(a){a.stopImmediatePropagation()}),j.play()}):"rewind"===e.end?i.on("ended.seeThru",function(){j.pause(),j.currentTime=0,"clicktoplay"==e.start&&o.one("click.seeThru",function(){j.play()})}):i.on("ended.seeThru",function(){j.pause(),"clicktoplay"==e.start&&o.one("click.seeThru",function(){j.play()})})}),this.videoWidth&&this.videoHeight&&a(this).trigger("loadedmetadata.seeThru")})},updateMask:function(c){var d=a.extend({mask:""},c);return this.each(function(){var c=a(this);if(!a(d.mask).length)throw new Error("Missing parameter 'mask'");var e=c.data("seeThru").staticMask,f=c.data("seeThru").alphaMask;if(!e)throw new Error("Cannot apply method '.updateMask()' to element with moving alpha");if("IMG"!==a(d.mask)[0].tagName)throw new Error("Passed mask element must be <img>");var g={width:c.width(),height:c.height()},h=a(d.mask)[0];h.width=g.width,h.height=g.height;var i=c.nextAll(".seeThru-buffer")[0].getContext("2d");f?i.putImageData(b(g,h),0,g.height):i.drawImage(h,0,g.height,g.width,g.height)})},revert:function(){return this.each(function(){var b=a(this);b.data("seeThru")&&(b.data("seeThru")&&"interval"in b.data("seeThru")&&cancelAnimationFrame(b.data("seeThru").interval),b.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first, .seeThru-display:first").remove())})},play:function(){return this.each(function(){a(this).data("seeThru")&&this.play()})},pause:function(){return this.each(function(){a(this).data("seeThru")&&this.pause()})},rewind:function(){return this.each(function(){a(this).data("seeThru")&&(this.pause(),this.currentTime=0)})}};a.fn.seeThru=function(a){if(d[a])return d[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof a&&a)throw new Error("Method "+a+" does not exist on jQuery.seeThru");return d.init.apply(this,arguments)}});